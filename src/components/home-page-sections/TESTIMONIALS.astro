---
import img from '~/assets/images/quote-img.png';
import QuotesCard from '~/components/QuotesCard.astro';
import type { SectionObject } from '~/api/api';
import { prepareContentFromJsonOrHTMLString } from '~/utils/utils';

const data = Array(8)
  .fill(null)
  .map(() => ({
    img: img,
    id: 1,
    auth: 'عائشة السعدي',
    position: 'نائبة برلمانية عن مجلس الأمة الكويتي.',
    title:
      'حكومة الاحتلال حكومة إعدام وتعمل علي تسليح مليشيات المستوطنين تحضيراً لتحقيق الحلم الصهيوني على حساب دول المنطقة.',
    link: '#',
  }));

export type Props = {
  section: SectionObject;
};
const locale = Astro.currentLocale || 'ar';
const { section } = Astro.props;
const sectionTitle = section.title[locale] || section.title['ar'];
const sectionDescription = section.description[locale] || section.description['ar'];

const category = section.sectionables.find(
  (sectionable) => sectionable.sectionable_type === 'App\\Models\\Category'
);

if (!category) {
  return null;
}
const posts =
  ((category as Sectionable)?.sectionable as CategoryObject).posts || [];
const postsData = posts.map((post) => ({
    img: post?.media?.find(
        (media) => media.collection_name === 'Media_Library_Thumbnails'
    )?.original_url || post?.media?.[0]?.original_url,
    id: post?.id,
    link: post?.link ? post.link : `/${locale}/post/${post?.slug}`,
    title: post?.title[locale] || post?.title['ar'],
    short_desc: post?.short_description[locale],
    desc: prepareContentFromJsonOrHTMLString(post?.description[locale],locale,true),
    }));
---

<div class="text-center py-[90px]  xl:py-[138px] main-padding relative w-full bg-page">
  <h2 class="text-primary-light text-4xl xl:text-[64px] font-[600]">
    {sectionTitle}
  </h2>
  <p class="xl:text-2xl mt-3 text-[#ABABAB] max-w-xl mx-auto line-clamp-2">
    {sectionDescription}
  </p>

  <div class="overflow-visible carousel-quotes mt-28 xl:mt-14">
    {
      postsData?.map((item) => {
        return (
          <div class={`carousel-cell   w-full lg:w-1/2 lg:pe-6 mx-10 lg:mx-0`}>
            <QuotesCard {...item} />
          </div>
        );
      })
    }
  </div>
</div>

<script is:inline data-astro-rerun src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
<script data-astro-rerun is:inline>
  new Flickity('.carousel-quotes', {
    // options, defaults listed
    accessibility: true,
    gutter: 10,
    autoPlay: false,
    freeScroll: false,
    friction: 0.5,
    groupCells: true,
    initialIndex: 0,
    lazyLoad: true,
    prevNextButtons: true,
    pageDots: false,
    adaptiveHeight: true,

    rightToLeft: document.dir === 'rtl',
    // wrapAround: true,
    // contain: true,
  });
</script>
